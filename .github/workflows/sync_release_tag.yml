name: Workflow to sync release tags from PyAEDT

on:
  workflow_dispatch:
    inputs:
      tag:
        description: "Release tag from PyAEDT to sync"
        required: true

permissions: {} # Disable default permissions at the workflow level

jobs:
  create-tag:
    name: Sync release tags from PyAEDT
    runs-on: ubuntu-latest
    permissions:
      contents: write # Needed to push tag on remote
    steps:
      - name: Checkout repository # zizmor: ignore[artipacked] , credentials must be persisted in this case
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
        with:
          persist-credentials: false

      - name: Create and push tag
        env:
          INPUTS_TAG: ${{ github.event.inputs.tag }}
          PYANSYS_CI_BOT_USERNAME: ${{ secrets.PYANSYS_CI_BOT_USERNAME }}
          PYANSYS_CI_BOT_EMAIL: ${{ secrets.PYANSYS_CI_BOT_EMAIL }}
        run: |
          # Configure git username & email
          git config --global user.name "${PYANSYS_CI_BOT_USERNAME}"
          git config --global user.email "${PYANSYS_CI_BOT_EMAIL}"

          TAG_NAME="${INPUTS_TAG}"

          if git rev-parse "$TAG_NAME" >/dev/null 2>&1; then
            echo "Tag $TAG_NAME already exists, skipping creation"
            exit 0
          fi

          echo "Creating tag: $TAG_NAME"
          git tag "$TAG_NAME"

          echo "Pushing tag to origin"
          git push origin "$TAG_NAME"

          echo "Successfully created and pushed tag: $TAG_NAME"
