name: Sync release tag from PyAEDT

on:
  workflow_dispatch:
    inputs:
      tag:
        description: "Release tag from PyAEDT to sync."
        required: true
        type: string
      token:
        description: "Token with permissions to create tags."
        required: true
        type: string
      user:
        description: "User value for git configuration."
        required: true
        type: string
      bot-email:
        description: "Email value for git configuration."
        required: true
        type: string
jobs:
  create-tag:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      metadata: read
    steps:
      - name: Checkout repository
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
        with:
<<<<<<< Updated upstream
          persist-credentials: false
=======
          fetch-tags: true
          token: ${{ inputs.token }} # zizmor: ignore[artipacked] , credentials should be persisted
>>>>>>> Stashed changes

      - name: Create and push tag
        run: |
          # Configure git username & email from inputs
          git config --global user.name "${{ github.event.inputs.bot-user }}"
          git config --global user.email "${{ github.event.inputs.bot-email }}"

          TAG_NAME="${{ github.event.inputs.tag }}"

          if git rev-parse "$TAG_NAME" >/dev/null 2>&1; then
            echo "Tag $TAG_NAME already exists, skipping creation"
            exit 0
          fi

          echo "Creating tag: $TAG_NAME"
          git tag "$TAG_NAME"

          echo "Pushing tag to origin"
          git push origin "$TAG_NAME"

          echo "Successfully created and pushed tag: $TAG_NAME"
