name: Sync release tag from PyAEDT

on:
  workflow_dispatch:
    inputs:
      tag:
        description: "Release tag from PyAEDT to sync"
        required: true

jobs:
  create-tag:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout repository # zizmor: ignore[artipacked] , credentials must be persisted in this case
        uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
        with:
          persist-credentials: false

      - name: Create and push tag
        run: |
          # Configure git username & email
          git config --global user.name "${{ secrets.PYANSYS_CI_BOT_USERNAME }}"
          git config --global user.email "${{ secrets.PYANSYS_CI_BOT_EMAIL }}"

          TAG_NAME="${{ github.event.inputs.tag }}"

          if git rev-parse "$TAG_NAME" >/dev/null 2>&1; then
            echo "Tag $TAG_NAME already exists, skipping creation"
            exit 0
          fi

          echo "Creating tag: $TAG_NAME"
          git tag "$TAG_NAME"

          echo "Pushing tag to origin"
          git push origin "$TAG_NAME"

          echo "Successfully created and pushed tag: $TAG_NAME"
